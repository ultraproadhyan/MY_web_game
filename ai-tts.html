<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate AI Voice Studio</title>
    <style>
        :root {
            --bg-color: #f5f5f5;
            --text-color: #333;
            --primary: #4a6bff;
            --secondary: #ff6b6b;
            --card-bg: #fff;
            --slider-bg: #ddd;
            --slider-fill: var(--primary);
        }
        .dark-mode {
            --bg-color: #121212;
            --text-color: #f0f0f0;
            --primary: #6b8cff;
            --secondary: #ff8e8e;
            --card-bg: #1e1e1e;
            --slider-bg: #444;
            --slider-fill: var(--primary);
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            transition: all 0.3s;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        h1 {
            color: var(--primary);
            margin: 0;
            font-size: 2.2rem;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        .mode-toggle {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        textarea {
            width: 100%;
            height: 200px;
            padding: 20px;
            border: 2px solid var(--slider-bg);
            border-radius: 12px;
            font-size: 16px;
            resize: none;
            background: var(--card-bg);
            color: var(--text-color);
            transition: all 0.3s;
        }
        textarea:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 107, 255, 0.2);
        }
        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 25px 0;
        }
        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s;
            font-weight: 600;
            min-width: 120px;
            justify-content: center;
        }
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        button:active {
            transform: translateY(0);
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        .btn-secondary {
            background: var(--secondary);
        }
        select {
            padding: 12px 15px;
            border-radius: 10px;
            border: 2px solid var(--slider-bg);
            background: var(--card-bg);
            color: var(--text-color);
            font-size: 16px;
            flex-grow: 1;
            min-width: 200px;
            cursor: pointer;
            transition: all 0.3s;
        }
        select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 107, 255, 0.2);
        }
        .voice-preview {
            margin-top: 30px;
            display: none;
            background: rgba(0,0,0,0.1);
            padding: 20px;
            border-radius: 12px;
        }
        audio {
            width: 100%;
            margin-top: 15px;
            border-radius: 8px;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .slider-container {
            margin: 20px 0;
            width: 100%;
        }
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 500;
        }
        .slider {
            -webkit-appearance: none;  /* Safari and Chrome */
    -moz-appearance: none;    /* Firefox */
    appearance: none;         /* Standard syntax */
            
    width: 100%;
    height: 10px;
    border-radius: 5px;
    background: var(--slider-bg);
    outline: none;
}
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            transition: all 0.2s;
        }
        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
        .slider-fill {
            position: absolute;
            height: 10px;
            border-radius: 5px;
            background: var(--slider-fill);
            pointer-events: none;
        }
        .advanced-controls {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .control-group {
            background: rgba(0,0,0,0.05);
            padding: 15px;
            border-radius: 10px;
        }
        .control-group h3 {
            margin-top: 0;
            color: var(--primary);
        }
        .voice-samples {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .voice-sample {
            background: rgba(0,0,0,0.1);
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        .voice-sample:hover {
            background: rgba(74, 107, 255, 0.2);
            transform: translateY(-3px);
        }
        .voice-sample.active {
            background: var(--primary);
            color: white;
        }
        .tab-container {
            display: flex;
            border-bottom: 1px solid var(--slider-bg);
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            transition: all 0.2s;
        }
        .tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .preset-btn {
            background: rgba(0,0,0,0.1);
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            margin-right: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .preset-btn:hover {
            background: var(--primary);
            color: white;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin-top: 15px;
            display: none;
        }
        .status.success {
            background: rgba(0, 200, 83, 0.2);
            color: #00c853;
            display: block;
        }
        .status.error {
            background: rgba(255, 0, 0, 0.2);
            color: #ff5252;
            display: block;
        }
        .file-input {
            display: none;
        }
        .file-label {
            display: inline-block;
            padding: 12px 25px;
            background: var(--secondary);
            color: white;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            text-align: center;
        }
        .file-label:hover {
            background: #ff5252;
            transform: translateY(-3px);
        }
        .voice-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 10px;
            display: block;
            border: 3px solid var(--primary);
        }
        .voice-info {
            text-align: center;
            margin-bottom: 15px;
        }
        .voice-name {
            font-weight: bold;
            font-size: 1.1rem;
            margin: 5px 0;
        }
        .voice-desc {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
            }
            select, button {
                width: 100%;
            }
            .advanced-controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1>Ultimate AI Voice Studio</h1>
                <p>प्रोफेशनल-ग्रेड टेक्स्ट-टू-स्पीच विथ फुल कस्टमाइजेशन</p>
            </div>
            <button class="mode-toggle" id="modeToggle">
                <span id="modeIcon">🌙</span> 
                <span id="modeText">डार्क मोड</span>
            </button>
        </header>

        <div class="card">
            <div class="tab-container">
                <div class="tab active" data-tab="text">टेक्स्ट इनपुट</div>
                <div class="tab" data-tab="file">फाइल इम्पोर्ट</div>
                <div class="tab" data-tab="advanced">एडवांस्ड</div>
            </div>
            
            <div class="tab-content active" id="text-tab">
                <h2>अपना टेक्स्ट दर्ज करें</h2>
                <textarea id="textInput" placeholder="यहाँ टेक्स्ट लिखें (100+ भाषाएँ और वॉइस स्टाइल सपोर्टेड)..."></textarea>
                
                <div class="controls">
                    <button id="pasteBtn">📋 पेस्ट करें</button>
                    <button id="clearBtn" class="btn-secondary">🗑️ क्लियर</button>
                </div>
            </div>
            
            <div class="tab-content" id="file-tab">
                <h2>टेक्स्ट फाइल इम्पोर्ट करें</h2>
                <p>टेक्स्ट फाइल (.txt, .docx, .pdf) अपलोड करें या वेबपेज से टेक्स्ट एक्सट्रेक्ट करें</p>
                
                <input type="file" id="fileInput" class="file-input" accept=".txt,.pdf,.docx">
                <label for="fileInput" class="file-label">📁 फाइल चुनें</label>
                
                <div class="controls">
                    <input type="text" id="webUrl" placeholder="वेबपेज URL दर्ज करें" style="flex-grow: 1; padding: 12px; border-radius: 8px; border: 1px solid var(--slider-bg); background: var(--card-bg); color: var(--text-color);">
                    <button id="extractBtn" class="btn-secondary">🌐 वेबपेज से टेक्स्ट निकालें</button>
                </div>
                
                <div id="fileStatus" class="status"></div>
            </div>
            
            <div class="tab-content" id="advanced-tab">
                <h2>एडवांस्ड वॉइस सेटिंग्स</h2>
                <div class="advanced-controls">
                    <div class="control-group">
                        <h3>वॉइस प्रीसेट्स</h3>
                        <div>
                            <button class="preset-btn" data-preset="news">न्यूज़ रिपोर्टर</button>
                            <button class="preset-btn" data-preset="story">कहानी वाचक</button>
                            <button class="preset-btn" data-preset="commercial">विज्ञापन वॉइस</button>
                            <button class="preset-btn" data-preset="teacher">शिक्षक</button>
                            <button class="preset-btn" data-preset="child">बच्चे की आवाज</button>
                            <button class="preset-btn" data-preset="robot">रोबोटिक</button>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <h3>वॉइस मॉड्यूलेशन</h3>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>स्पीड: <span id="speedValue">1.0</span>x</span>
                            </div>
                            <input type="range" min="0.5" max="2" step="0.1" value="1" class="slider" id="speedSlider">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>पिच: <span id="pitchValue">100</span>%</span>
                            </div>
                            <input type="range" min="50" max="150" step="1" value="100" class="slider" id="pitchSlider">
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <h3>वॉइस इफेक्ट्स</h3>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>इको: <span id="echoValue">0</span>%</span>
                            </div>
                            <input type="range" min="0" max="100" step="1" value="0" class="slider" id="echoSlider">
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>रिवर्ब: <span id="reverbValue">0</span>%</span>
                            </div>
                            <input type="range" min="0" max="100" step="1" value="0" class="slider" id="reverbSlider">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>वॉइस सेलेक्शन</h2>
            
            <div class="controls">
                <select id="languageSelect">
                    <option value="hi-IN">हिंदी (भारत)</option>
                    <option value="en-US">अंग्रेजी (US)</option>
                    <option value="en-GB">अंग्रेजी (UK)</option>
                    <option value="pa-IN">पंजाबी (भारत)</option>
                    <option value="ta-IN">तमिल (भारत)</option>
                    <option value="te-IN">तेलुगु (भारत)</option>
                    <option value="mr-IN">मराठी (भारत)</option>
                    <option value="bn-IN">बांग्ला (भारत)</option>
                    <option value="gu-IN">गुजराती (भारत)</option>
                    <option value="kn-IN">कन्नड़ (भारत)</option>
                    <option value="ml-IN">मलयालम (भारत)</option>
                    <option value="es-ES">स्पेनिश (स्पेन)</option>
                    <option value="fr-FR">फ्रेंच (फ्रांस)</option>
                    <option value="de-DE">जर्मन (जर्मनी)</option>
                    <option value="it-IT">इतालियन (इटली)</option>
                    <option value="ja-JP">जापानी (जापान)</option>
                    <option value="zh-CN">चीनी (चीन)</option>
                    <option value="ru-RU">रूसी (रूस)</option>
                    <option value="ar-SA">अरबी (सऊदी अरब)</option>
                    <option value="ko-KR">कोरियाई (कोरिया)</option>
                </select>
                
                <select id="voiceSelect">
                    <option value="default">डिफ़ॉल्ट आवाज़</option>
                </select>
                
                <button id="refreshVoicesBtn">
                    🔄 वॉइस रिफ्रेश करें
                </button>
            </div>
            
            <h3 style="margin-top: 30px;">प्रीमियम वॉइस प्रोफाइल्स</h3>
            <div class="voice-samples">
                <div class="voice-sample" data-voice="hi-male-1">
                    <img src="https://i.imgur.com/Jm6h8yO.png" alt="Male Voice 1" class="voice-avatar">
                    <div class="voice-info">
                        <div class="voice-name">राहुल (पुरुष)</div>
                        <div class="voice-desc">स्मूथ और कॉन्फिडेंट</div>
                    </div>
                </div>
                
                <div class="voice-sample" data-voice="hi-female-1">
                    <img src="https://i.imgur.com/WCz8tQz.png" alt="Female Voice 1" class="voice-avatar">
                    <div class="voice-info">
                        <div class="voice-name">प्रिया (महिला)</div>
                        <div class="voice-desc">सॉफ्ट और क्लियर</div>
                    </div>
                </div>
                
                <div class="voice-sample" data-voice="hi-male-2">
                    <img src="https://i.imgur.com/3tTQq7J.png" alt="Male Voice 2" class="voice-avatar">
                    <div class="voice-info">
                        <div class="voice-name">विक्रम (पुरुष)</div>
                        <div class="voice-desc">डीप और अथॉरिटेटिव</div>
                    </div>
                </div>
                
                <div class="voice-sample" data-voice="hi-female-2">
                    <img src="https://i.imgur.com/5X6Qy9t.png" alt="Female Voice 2" class="voice-avatar">
                    <div class="voice-info">
                        <div class="voice-name">अंजली (महिला)</div>
                        <div class="voice-desc">एनर्जेटिक और यंग</div>
                    </div>
                </div>
                
                <div class="voice-sample" data-voice="en-male-1">
                    <img src="https://i.imgur.com/mFnkXyS.png" alt="English Male" class="voice-avatar">
                    <div class="voice-info">
                        <div class="voice-name">डेविड (US)</div>
                        <div class="voice-desc">प्रोफेशनल और क्लियर</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>वॉइस कंट्रोल्स</h2>
            
            <div class="controls">
                <button id="speakButton">
                    <span id="speakIcon">🎤</span> स्पीक
                </button>
                
                <button id="stopButton" class="btn-secondary" disabled>
                    ⏹️ स्टॉप
                </button>
                
                <button id="pauseButton" class="btn-secondary" disabled>
                    ⏸️ पॉज
                </button>
                
                <button id="resumeButton" class="btn-secondary" disabled>
                    ▶️ रिज्यूम
                </button>
                
                <button id="downloadButton">
                    ⬇️ MP3 डाउनलोड
                </button>
                
                <button id="shareButton">
                    🔗 शेयर
                </button>
            </div>
            
            <div class="slider-container" style="margin-top: 20px;">
                <div class="slider-label">
                    <span>वॉल्यूम: <span id="volumeValue">100</span>%</span>
                </div>
                <input type="range" min="0" max="100" step="1" value="100" class="slider" id="volumeSlider">
            </div>
            
            <div class="voice-preview" id="voicePreview">
                <h3>वॉइस प्रिव्यू:</h3>
                <audio id="audioPlayer" controls></audio>
                
                <div class="controls" style="margin-top: 15px;">
                    <button id="savePresetBtn">💾 प्रीसेट सेव करें</button>
                    <button id="exportBtn">📁 एक्सपोर्ट प्रोजेक्ट</button>
                </div>
            </div>
            
            <div id="statusMessage" class="status"></div>
        </div>
    </div>

    <!-- External Libraries -->
    <script src="https://code.responsivevoice.org/responsivevoice.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/RecordRTC/5.6.2/RecordRTC.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.1.0/docx.min.js"></script>
    
    <script>
        // Initialize PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js';
    
        // DOM Elements
        const modeToggle = document.getElementById('modeToggle');
        const modeIcon = document.getElementById('modeIcon');
        const modeText = document.getElementById('modeText');
        const textInput = document.getElementById('textInput');
        const languageSelect = document.getElementById('languageSelect');
        const voiceSelect = document.getElementById('voiceSelect');
        const speakButton = document.getElementById('speakButton');
        const speakIcon = document.getElementById('speakIcon');
        const stopButton = document.getElementById('stopButton');
        const pauseButton = document.getElementById('pauseButton');
        const resumeButton = document.getElementById('resumeButton');
        const downloadButton = document.getElementById('downloadButton');
        const shareButton = document.getElementById('shareButton');
        const voicePreview = document.getElementById('voicePreview');
        const audioPlayer = document.getElementById('audioPlayer');
        const refreshVoicesBtn = document.getElementById('refreshVoicesBtn');
        const pasteBtn = document.getElementById('pasteBtn');
        const clearBtn = document.getElementById('clearBtn');
        const fileInput = document.getElementById('fileInput');
        const webUrl = document.getElementById('webUrl');
        const extractBtn = document.getElementById('extractBtn');
        const fileStatus = document.getElementById('fileStatus');
        const speedSlider = document.getElementById('speedSlider');
        const speedValue = document.getElementById('speedValue');
        const pitchSlider = document.getElementById('pitchSlider');
        const pitchValue = document.getElementById('pitchValue');
        const echoSlider = document.getElementById('echoSlider');
        const echoValue = document.getElementById('echoValue');
        const reverbSlider = document.getElementById('reverbSlider');
        const reverbValue = document.getElementById('reverbValue');
        const volumeSlider = document.getElementById('volumeSlider');
        const volumeValue = document.getElementById('volumeValue');
        const savePresetBtn = document.getElementById('savePresetBtn');
        const exportBtn = document.getElementById('exportBtn');
        const statusMessage = document.getElementById('statusMessage');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const voiceSamples = document.querySelectorAll('.voice-sample');
        const presetBtns = document.querySelectorAll('.preset-btn');
    
        // Premium Voice Profiles
        const premiumVoices = {
            'hi-male-1': {
                name: 'राहुल (पुरुष)',
                desc: 'स्मूथ और कॉन्फिडेंट',
                lang: 'hi-IN',
                voiceURI: 'hi-IN-Standard-A',
                gender: 'male',
                pitch: 0.9,
                rate: 1.0
            },
            'hi-female-1': {
                name: 'प्रिया (महिला)',
                desc: 'सॉफ्ट और क्लियर',
                lang: 'hi-IN',
                voiceURI: 'hi-IN-Standard-B',
                gender: 'female',
                pitch: 1.1,
                rate: 1.0
            },
            'hi-male-2': {
                name: 'विक्रम (पुरुष)',
                desc: 'डीप और अथॉरिटेटिव',
                lang: 'hi-IN',
                voiceURI: 'hi-IN-Standard-C',
                gender: 'male',
                pitch: 0.8,
                rate: 0.9
            },
            'hi-female-2': {
                name: 'अंजली (महिला)',
                desc: 'एनर्जेटिक और यंग',
                lang: 'hi-IN',
                voiceURI: 'hi-IN-Standard-D',
                gender: 'female',
                pitch: 1.2,
                rate: 1.1
            },
            'en-male-1': {
                name: 'डेविड (US)',
                desc: 'प्रोफेशनल और क्लियर',
                lang: 'en-US',
                voiceURI: 'en-US-Standard-A',
                gender: 'male',
                pitch: 1.0,
                rate: 1.0
            }
        };
    
        // App State
        let currentAudio = null;
        let audioContext;
        let mediaRecorder;
        let audioChunks = [];
        let isPaused = false;
        let isSpeaking = false;
        let currentVoiceSettings = {
            speed: 1.0,
            pitch: 100,
            echo: 0,
            reverb: 0,
            volume: 100,
            preset: 'default'
        };
        let selectedVoiceProfile = null;
    
        // Initialize
        init();
    
        function init() {
            // Check for saved preferences
            loadPreferences();
            
            // Setup event listeners
            setupEventListeners();
            
            // Populate voices
            populateVoiceList();
            
            // Setup sliders
            updateSliderValues();
            
            // Initialize ResponsiveVoice
            responsiveVoice.init();
        }
    
        function setupEventListeners() {
            // Dark/light mode toggle
            modeToggle.addEventListener('click', toggleDarkMode);
            
            // Tab switching
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
                });
            });
            
            // Voice selection
            refreshVoicesBtn.addEventListener('click', populateVoiceList);
            languageSelect.addEventListener('change', populateVoiceList);
            
            // Text operations
            pasteBtn.addEventListener('click', pasteText);
            clearBtn.addEventListener('click', clearText);
            
            // File operations
            fileInput.addEventListener('change', handleFileUpload);
            extractBtn.addEventListener('click', extractWebText);
            
            // Voice controls
            speakButton.addEventListener('click', speakText);
            stopButton.addEventListener('click', stopSpeech);
            pauseButton.addEventListener('click', pauseSpeech);
            resumeButton.addEventListener('click', resumeSpeech);
            downloadButton.addEventListener('click', downloadAudio);
            shareButton.addEventListener('click', shareAudio);
            
            // Voice samples
            voiceSamples.forEach(sample => {
                sample.addEventListener('click', () => {
                    voiceSamples.forEach(s => s.classList.remove('active'));
                    sample.classList.add('active');
                    
                    const voiceId = sample.dataset.voice;
                    selectedVoiceProfile = premiumVoices[voiceId];
                    
                    // Update language selection
                    languageSelect.value = selectedVoiceProfile.lang;
                    
                    // Update voice settings
                    speedSlider.value = selectedVoiceProfile.rate;
                    pitchSlider.value = selectedVoiceProfile.pitch * 100;
                    updateSliderValues();
                    
                    // Show preview of the voice
                    showStatus(`Voice profile "${selectedVoiceProfile.name}" selected`, 'success');
                    
                    // Auto-populate voices for the selected language
                    populateVoiceList();
                });
            });
            
            // Preset buttons
            presetBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    applyPreset(btn.dataset.preset);
                });
            });
            
            // Sliders
            speedSlider.addEventListener('input', updateSliderValues);
            pitchSlider.addEventListener('input', updateSliderValues);
            echoSlider.addEventListener('input', updateSliderValues);
            reverbSlider.addEventListener('input', updateSliderValues);
            volumeSlider.addEventListener('input', updateSliderValues);
            
            // Save/export
            savePresetBtn.addEventListener('click', savePreset);
            exportBtn.addEventListener('click', exportProject);
            
            // Audio player events
            audioPlayer.addEventListener('play', () => {
                pauseButton.disabled = false;
                stopButton.disabled = false;
            });
            
            audioPlayer.addEventListener('pause', () => {
                pauseButton.disabled = true;
                resumeButton.disabled = false;
            });
            
            audioPlayer.addEventListener('ended', () => {
                pauseButton.disabled = true;
                stopButton.disabled = true;
                resumeButton.disabled = true;
            });
            
            // Initialize speech synthesis
            if ('speechSynthesis' in window) {
                window.speechSynthesis.onvoiceschanged = populateVoiceList;
            }
        }
    
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            
            modeIcon.textContent = isDark ? '☀️' : '🌙';
            modeText.textContent = isDark ? 'लाइट मोड' : 'डार्क मोड';
            
            // Save preference
            localStorage.setItem('darkMode', isDark);
        }
    
        function loadPreferences() {
            // Load dark mode preference
            const darkMode = localStorage.getItem('darkMode') === 'true';
            if (darkMode) {
                document.body.classList.add('dark-mode');
                modeIcon.textContent = '☀️';
                modeText.textContent = 'लाइट मोड';
            }
            
            // Load voice preferences if any
            const savedSettings = localStorage.getItem('voiceSettings');
            if (savedSettings) {
                currentVoiceSettings = JSON.parse(savedSettings);
                speedSlider.value = currentVoiceSettings.speed;
                pitchSlider.value = currentVoiceSettings.pitch;
                echoSlider.value = currentVoiceSettings.echo;
                reverbSlider.value = currentVoiceSettings.reverb;
                volumeSlider.value = currentVoiceSettings.volume;
                updateSliderValues();
            }
        }
    
        function updateSliderValues() {
            currentVoiceSettings.speed = parseFloat(speedSlider.value);
            currentVoiceSettings.pitch = parseInt(pitchSlider.value);
            currentVoiceSettings.echo = parseInt(echoSlider.value);
            currentVoiceSettings.reverb = parseInt(reverbSlider.value);
            currentVoiceSettings.volume = parseInt(volumeSlider.value);
            
            speedValue.textContent = currentVoiceSettings.speed.toFixed(1);
            pitchValue.textContent = currentVoiceSettings.pitch;
            echoValue.textContent = currentVoiceSettings.echo;
            reverbValue.textContent = currentVoiceSettings.reverb;
            volumeValue.textContent = currentVoiceSettings.volume;
            
            // Update audio player volume
            if (audioPlayer) {
                audioPlayer.volume = currentVoiceSettings.volume / 100;
            }
        }
    
        function populateVoiceList() {
            voiceSelect.innerHTML = '<option value="default">डिफ़ॉल्ट आवाज़</option>';
            
            if ('speechSynthesis' in window) {
                // Force voices to load (some browsers need this)
                window.speechSynthesis.getVoices();
                
                // Some browsers need a short delay
                setTimeout(() => {
                    const voices = window.speechSynthesis.getVoices();
                    const lang = languageSelect.value;
                    
                    // Filter voices for selected language
                    const filteredVoices = voices.filter(voice => voice.lang === lang);
                    
                    if (filteredVoices.length === 0) {
                        showStatus('No voices available for selected language', 'error');
                        return;
                    }
                    
                    filteredVoices.forEach((voice, index) => {
                        const option = document.createElement('option');
                        option.value = index;
                        option.textContent = `${voice.name} (${voice.lang})`;
                        
                        // Select the voice if it matches our premium profile
                        if (selectedVoiceProfile && voice.voiceURI.includes(selectedVoiceProfile.voiceURI)) {
                            option.selected = true;
                        }
                        
                        voiceSelect.appendChild(option);
                    });
                    
                    showStatus('Voice list updated', 'success');
                }, 100);
            } else {
                showStatus('Web Speech API not supported', 'error');
            }
        }
    
        function speakText() {
            const text = textInput.value.trim();
            const lang = languageSelect.value;
            const voiceIndex = voiceSelect.value;
            
            if (!text) {
                showStatus('Please enter text to speak', 'error');
                return;
            }
            
            // Stop any ongoing speech
            if (isSpeaking) {
                stopSpeech();
            }
            
            // Update button states
            speakButton.disabled = true;
            speakIcon.className = 'loading';
            stopButton.disabled = false;
            pauseButton.disabled = false;
            resumeButton.disabled = true;
            downloadButton.disabled = true;
            isPaused = false;
            isSpeaking = true;
            
            try {
                // Setup audio context for recording
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const dest = audioContext.createMediaStreamDestination();
                mediaRecorder = new MediaRecorder(dest.stream);
                audioChunks = [];
                
                mediaRecorder.ondataavailable = (e) => {
                    audioChunks.push(e.data);
                };
                
                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    currentAudio = URL.createObjectURL(audioBlob);
                    
                    audioPlayer.src = currentAudio;
                    voicePreview.style.display = 'block';
                    downloadButton.disabled = false;
                    
                    speakButton.disabled = false;
                    speakIcon.className = '';
                    speakIcon.textContent = '🎤';
                    stopButton.disabled = true;
                    pauseButton.disabled = true;
                    isSpeaking = false;
                };
                
                mediaRecorder.start();
                
                // Use Web Speech API if available
                if ('speechSynthesis' in window && voiceIndex !== 'default') {
                    const voices = window.speechSynthesis.getVoices();
                    if (voices.length > 0 && voiceIndex < voices.length) {
                        const utterance = new SpeechSynthesisUtterance(text);
                        utterance.voice = voices[voiceIndex];
                        
                        // Apply voice settings
                        utterance.rate = currentVoiceSettings.speed;
                        utterance.pitch = currentVoiceSettings.pitch / 100;
                        
                        // Apply premium voice profile settings if selected
                        if (selectedVoiceProfile) {
                            utterance.rate = selectedVoiceProfile.rate * currentVoiceSettings.speed;
                            utterance.pitch = selectedVoiceProfile.pitch * (currentVoiceSettings.pitch / 100);
                        }
                        
                        utterance.onstart = () => {
                            showStatus('Speaking...', 'success');
                        };
                        
                        utterance.onend = () => {
                            mediaRecorder.stop();
                            showStatus('Speech completed', 'success');
                        };
                        
                        utterance.onerror = (event) => {
                            showStatus(`Error: ${event.error}`, 'error');
                            mediaRecorder.stop();
                        };
                        
                        window.speechSynthesis.speak(utterance);
                        return;
                    }
                }
                
                // Fallback to ResponsiveVoice
                const voiceMap = {
                    'hi-IN': 'Hindi Female',
                    'en-US': 'US English Female',
                    'en-GB': 'UK English Female',
                    'pa-IN': 'Hindi Female',
                    'ta-IN': 'Hindi Female',
                    'te-IN': 'Hindi Female',
                    'mr-IN': 'Hindi Female',
                    'bn-IN': 'Hindi Female',
                    'gu-IN': 'Hindi Female',
                    'kn-IN': 'Hindi Female',
                    'ml-IN': 'Hindi Female',
                    'es-ES': 'Spanish Female',
                    'fr-FR': 'French Female',
                    'de-DE': 'Deutsch Female',
                    'it-IT': 'Italian Female',
                    'ja-JP': 'Japanese Female',
                    'zh-CN': 'Chinese Female',
                    'ru-RU': 'Russian Female',
                    'ar-SA': 'Arabic Female',
                    'ko-KR': 'Korean Female'
                };
                
                const voice = voiceMap[lang] || 'Hindi Female';
                let rate = currentVoiceSettings.speed;
                let pitch = currentVoiceSettings.pitch / 100;
                const volume = currentVoiceSettings.volume / 100;
                
                // Apply premium voice profile settings if selected
                if (selectedVoiceProfile) {
                    rate = selectedVoiceProfile.rate * currentVoiceSettings.speed;
                    pitch = selectedVoiceProfile.pitch * (currentVoiceSettings.pitch / 100);
                }
                
                responsiveVoice.speak(text, voice, {
                    rate: rate,
                    pitch: pitch,
                    volume: volume,
                    onstart: () => {
                        showStatus('Speaking...', 'success');
                    },
                    onend: () => {
                        mediaRecorder.stop();
                        showStatus('Speech completed', 'success');
                    },
                    onerror: (error) => {
                        showStatus(`Error: ${error}`, 'error');
                        mediaRecorder.stop();
                    }
                });
                
            } catch (error) {
                showStatus(`Error: ${error.message}`, 'error');
                speakButton.disabled = false;
                speakIcon.className = '';
                speakIcon.textContent = '🎤';
                stopButton.disabled = true;
                isSpeaking = false;
            }
        }
    
        function stopSpeech() {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
            }
            responsiveVoice.cancel();
            
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
            }
            
            speakButton.disabled = false;
            speakIcon.className = '';
            speakIcon.textContent = '🎤';
            stopButton.disabled = true;
            pauseButton.disabled = true;
            resumeButton.disabled = true;
            isSpeaking = false;
            isPaused = false;
            
            showStatus('Speech stopped', 'success');
        }
    
        function pauseSpeech() {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.pause();
            }
            responsiveVoice.pause();
            
            isPaused = true;
            pauseButton.disabled = true;
            resumeButton.disabled = false;
            
            showStatus('Speech paused', 'success');
        }
    
        function resumeSpeech() {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.resume();
            }
            responsiveVoice.resume();
            
            isPaused = false;
            pauseButton.disabled = false;
            resumeButton.disabled = true;
            
            showStatus('Speech resumed', 'success');
        }
    
        function downloadAudio() {
            if (!currentAudio) return;
            
            const a = document.createElement('a');
            a.href = currentAudio;
            a.download = `tts-${new Date().getTime()}.wav`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            showStatus('Audio downloaded', 'success');
        }
    
        function shareAudio() {
            if (!currentAudio) {
                showStatus('No audio to share', 'error');
                return;
            }
            
            if (navigator.share) {
                navigator.share({
                    title: 'AI Generated Voice',
                    text: 'Check out this AI generated voice message',
                    url: currentAudio
                }).catch(error => {
                    showStatus(`Error sharing: ${error}`, 'error');
                });
            } else {
                // Fallback for browsers that don't support Web Share API
                const tempInput = document.createElement('input');
                tempInput.value = currentAudio;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                
                showStatus('Link copied to clipboard', 'success');
            }
        }
    
        function pasteText() {
            navigator.clipboard.readText()
                .then(text => {
                    textInput.value = text;
                    showStatus('Text pasted from clipboard', 'success');
                })
                .catch(err => {
                    showStatus('Failed to read clipboard. Please paste manually.', 'error');
                    textInput.focus();
                });
        }
    
        function clearText() {
            textInput.value = '';
            showStatus('Text cleared', 'success');
        }
    
        async function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            try {
                let text = '';
                const fileType = file.name.split('.').pop().toLowerCase();
                
                if (fileType === 'txt') {
                    text = await file.text();
                } else if (fileType === 'pdf') {
                    text = await extractTextFromPDF(file);
                } else if (fileType === 'docx') {
                    text = await extractTextFromDOCX(file);
                } else {
                    showStatus('Unsupported file type', 'error');
                    return;
                }
                
                textInput.value = text;
                fileStatus.textContent = `Text imported from ${file.name}`;
                fileStatus.className = 'status success';
            } catch (error) {
                showStatus(`Error reading file: ${error.message}`, 'error');
            }
        }
    
        async function extractTextFromPDF(file) {
            try {
                const arrayBuffer = await file.arrayBuffer();
                const loadingTask = pdfjsLib.getDocument(arrayBuffer);
                const pdf = await loadingTask.promise;
                let text = '';
                
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const content = await page.getTextContent();
                    const strings = content.items.map(item => item.str);
                    text += strings.join(' ') + '\n';
                }
                
                return text;
            } catch (error) {
                throw new Error('Failed to extract text from PDF');
            }
        }
    
        async function extractTextFromDOCX(file) {
            try {
                const arrayBuffer = await file.arrayBuffer();
                const result = await mammoth.extractRawText({arrayBuffer: arrayBuffer});
                return result.value;
            } catch (error) {
                throw new Error('Failed to extract text from DOCX');
            }
        }
    
        async function extractWebText() {
            const url = webUrl.value.trim();
            if (!url) {
                showStatus('Please enter a URL', 'error');
                return;
            }
            
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                showStatus('Please enter a valid URL (start with http:// or https://)', 'error');
                return;
            }
            
            try {
                // In a real app, you would use a proper CORS proxy or backend service
                // This is just a placeholder implementation
                showStatus('Extracting text from webpage...', 'success');
                
                // For demo purposes, we'll simulate extraction with a timeout
                textInput.value = `[This would be text extracted from ${url} in a real implementation]\n\nFor demonstration purposes, here's placeholder text. In a real application, this would be replaced with actual content extracted from the webpage. The implementation would need a backend service to properly scrape web content due to CORS restrictions.`;
                
                fileStatus.textContent = `Text extracted from ${url}`;
                fileStatus.className = 'status success';
            } catch (error) {
                showStatus(`Error extracting web text: ${error.message}`, 'error');
            }
        }
    
        function applyPreset(preset) {
            switch(preset) {
                case 'news':
                    speedSlider.value = 1.1;
                    pitchSlider.value = 95;
                    echoSlider.value = 10;
                    reverbSlider.value = 5;
                    break;
                case 'story':
                    speedSlider.value = 0.9;
                    pitchSlider.value = 105;
                    echoSlider.value = 5;
                    reverbSlider.value = 15;
                    break;
                case 'commercial':
                    speedSlider.value = 1.2;
                    pitchSlider.value = 110;
                    echoSlider.value = 0;
                    reverbSlider.value = 0;
                    break;
                case 'teacher':
                    speedSlider.value = 0.8;
                    pitchSlider.value = 100;
                    echoSlider.value = 0;
                    reverbSlider.value = 0;
                    break;
                case 'child':
                    speedSlider.value = 1.3;
                    pitchSlider.value = 130;
                    echoSlider.value = 0;
                    reverbSlider.value = 0;
                    break;
                case 'robot':
                    speedSlider.value = 0.7;
                    pitchSlider.value = 70;
                    echoSlider.value = 30;
                    reverbSlider.value = 20;
                    break;
                default:
                    speedSlider.value = 1.0;
                    pitchSlider.value = 100;
                    echoSlider.value = 0;
                    reverbSlider.value = 0;
            }
            
            updateSliderValues();
            currentVoiceSettings.preset = preset;
            showStatus(`Preset "${preset}" applied`, 'success');
        }
    
        function savePreset() {
            localStorage.setItem('voiceSettings', JSON.stringify(currentVoiceSettings));
            showStatus('Voice settings saved', 'success');
        }
    
        function exportProject() {
            const projectData = {
                text: textInput.value,
                settings: currentVoiceSettings,
                language: languageSelect.value,
                voice: voiceSelect.value,
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(projectData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `voice-project-${new Date().getTime()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            showStatus('Project exported', 'success');
        }
    
        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = 'status ' + type;
            statusMessage.style.display = 'block';
            statusMessage.style.opacity = '1';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                statusMessage.style.opacity = '0';
                setTimeout(() => {
                    statusMessage.style.display = 'none';
                }, 500);
            }, 5000);
        }
    
        // Initialize voices when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            if ('speechSynthesis' in window) {
                // Some browsers need this to populate voices
                window.speechSynthesis.getVoices();
            }
        });
    </script>
</body>
</html>
    